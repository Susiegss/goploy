(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e67f3d6"],{"01f9":function(t,e,a){"use strict";var o=a("875e"),r=a.n(o);r.a},"698f":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"app-container"},[a("el-row",{staticClass:"app-bar",attrs:{type:"flex",justify:"end",align:"middle"}},["template"===t.activeTableName?a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleTemplateAdd}},[t._v("添加")]):a("el-upload",{ref:"upload",attrs:{action:t.action,"before-upload":t.beforeUpload,"on-success":t.handleUploadSuccess,"on-remove":t.handleRemove,"before-remove":t.beforeRemove,"show-file-list":!1,multiple:""}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1),t._v(" "),a("el-tabs",{staticStyle:{"box-shadow":"none"},attrs:{type:"border-card"},model:{value:t.activeTableName,callback:function(e){t.activeTableName=e},expression:"activeTableName"}},[a("el-tab-pane",{attrs:{label:"模板",name:"template"}},[a("el-table",{attrs:{border:"",stripe:"","highlight-current-row":"",data:t.templateTableData}},[a("el-table-column",{attrs:{prop:"name",label:"名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"描述"}}),t._v(" "),a("el-table-column",{attrs:{prop:"insertTime",label:"创建时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"operation",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){return t.handleTemplateEdit(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){return t.handleTemplateDelete(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{"hide-on-single-page":"",total:t.tplPagination.total,"page-size":t.tplPagination.rows,background:"",layout:"prev, pager, next"},on:{"current-change":t.handleTplPageChange}})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"安装包",name:"package"}},[a("el-table",{attrs:{border:"",stripe:"","highlight-current-row":"",data:t.packageTableData}},[a("el-table-column",{attrs:{prop:"name",label:"名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"humanSize",label:"大小"}}),t._v(" "),a("el-table-column",{attrs:{prop:"insertTime",label:"创建时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"160"}}),t._v(" "),a("el-table-column",{attrs:{prop:"operation",label:"操作",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-upload",{ref:"upload",attrs:{action:t.action+"?packageId="+e.row.id,"before-upload":t.beforeUpload,"on-success":t.handleUploadSuccess,"on-remove":t.handleRemove,"before-remove":t.beforeRemove,"show-file-list":!1,multiple:""}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("重传")])],1)]}}])})],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{"hide-on-single-page":"",total:t.pkgPagination.total,"page-size":t.pkgPagination.rows,background:"",layout:"prev, pager, next"},on:{"current-change":t.handlePkgPageChange}})],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"模板设置",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"form",attrs:{rules:t.formRules,model:t.formData,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"remark"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"安装包",prop:"package"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择安装包",multiple:"",clearable:"",filterable:""},model:{value:t.formData.packageIds,callback:function(e){t.$set(t.formData,"packageIds",e)},expression:"formData.packageIds"}},t._l(t.packageOption,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"脚本",prop:"script"}},[t._v("\n        注意：安装包上传至目标服务器的/tmp目录\n        "),a("codemirror",{attrs:{options:t.cmOptions},model:{value:t.formData.script,callback:function(e){t.$set(t.formData,"script",e)},expression:"formData.script"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{disabled:t.formProps.disabled,type:"primary"},on:{click:t.submitTemplate}},[t._v("确 定")])],1)],1)],1)},r=[],l=(a("9a33"),a("cc57"),a("6d57"),a("c621")),n=a("b775");function i(t){var e=t.page,a=t.rows;return Object(n["a"])({url:"/package/getList",method:"get",params:{page:e,rows:a}})}function s(){return Object(n["a"])({url:"/package/getTotal",method:"get",params:{}})}var c=a("ed08"),p=a("8a2b"),m=(a("2750"),a("ca46"),a("81ea"),a("b382"),a("7c4f"),{components:{codemirror:p["codemirror"]},data:function(){return{dialogVisible:!1,activeTableName:"template",templateTableData:[],tplPagination:{page:1,rows:11,total:0},packageTableData:[],pkgPagination:{page:1,rows:11,total:0},packageOption:[],action:"/package/upload",tempFormData:{},cmOptions:{tabSize:4,mode:"text/x-sh",lineNumbers:!0,line:!0,scrollbarStyle:"overlay",theme:"darcula"},formProps:{disabled:!1},formData:{id:0,name:"",remark:"",packageIds:[],packageIdStr:"",script:""},formRules:{name:[{required:!0,message:"名称",trigger:"blur"}],script:[{required:!0,message:"请输入脚本",trigger:"blur"}]}}},created:function(){this.storeFormData(),this.getTemplateList(),this.getTemplateTotal(),this.getPackageList(),this.getPackageTotal()},methods:{getTemplateList:function(){var t=this;Object(l["c"])(this.tplPagination).then((function(e){t.templateTableData=e.data.list}))},getTemplateTotal:function(){var t=this;Object(l["e"])().then((function(e){t.tplPagination.total=e.data.total}))},handleTplPageChange:function(t){this.tplPagination.page=t,this.getTemplateList()},getPackageList:function(){var t=this;i(this.pkgPagination).then((function(e){var a=e.data.list;a.forEach((function(t){t.humanSize=Object(c["a"])(t.size)})),t.packageOption=t.packageTableData=a}))},getPackageTotal:function(){var t=this;s().then((function(e){t.pkgPagination.total=e.data.total}))},handlePkgPageChange:function(t){this.pkgPagination.page=t,this.getPackageList()},beforeUpload:function(t){this.$message.info("正在上传")},handleUploadSuccess:function(t,e,a){0!==t.code?this.$message.error(t.message):(this.$message.success("上传成功"),this.getPackageList(),this.getPackageTotal())},handleRemove:function(t,e){console.log(t,e)},beforeRemove:function(t,e){return Object(l["g"])(this.formData.id,t.name).then((function(t){return Promise.resolve(t)})).catch((function(t){return Promise.reject(t)}))},handleTemplateAdd:function(){this.formProps.fileList=[],this.restoreFormData(),this.dialogVisible=!0},handleTemplateEdit:function(t){this.formData=Object.assign(this.formData,t),this.formData.packageIds=t.packageIdStr.split(",").map((function(t){return parseInt(t)})),this.dialogVisible=!0},handleTemplateDelete:function(t){var e=this;this.$confirm("此操作将删除该模板, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["f"])(t.id).then((function(t){e.$message.success("删除成功"),e.getTemplateList(),e.getTemplateTotal()}))})).catch((function(){e.$message.info("已取消删除")}))},submitTemplate:function(){var t=this;this.$refs.form.validate((function(e){if(!e)return!1;t.formData.packageIdStr=t.formData.packageIds.join(","),0===t.formData.id?t.addTemplate():t.editTemplate()}))},addTemplate:function(){var t=this;this.formProps.disabled=!0,Object(l["a"])(this.formData).then((function(e){t.getTemplateList(),t.getTemplateTotal(),t.$message.success("添加成功")})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},editTemplate:function(){var t=this;this.formProps.disabled=!0,Object(l["b"])(this.formData).then((function(e){t.getTemplateList(),t.$message("修改成功")})).finally((function(){t.formProps.disabled=t.dialogVisible=!1}))},storeFormData:function(){this.tempFormData=JSON.parse(JSON.stringify(this.formData))},restoreFormData:function(){this.formData=JSON.parse(JSON.stringify(this.tempFormData))}}}),u=m,d=(a("01f9"),a("4023")),f=Object(d["a"])(u,o,r,!1,null,null,null);e["default"]=f.exports},"875e":function(t,e,a){},c621:function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"e",(function(){return l})),a.d(e,"d",(function(){return n})),a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s})),a.d(e,"f",(function(){return c})),a.d(e,"g",(function(){return p}));var o=a("b775");function r(t){var e=t.page,a=t.rows;return Object(o["a"])({url:"/template/getList",method:"get",params:{page:e,rows:a}})}function l(){return Object(o["a"])({url:"/template/getTotal",method:"get",params:{}})}function n(){return Object(o["a"])({url:"/template/getOption",method:"get"})}function i(t){return Object(o["a"])({url:"/template/add",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/template/edit",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/template/remove",method:"delete",data:{id:t}})}function p(t,e){return Object(o["a"])({url:"/template/removePackage",method:"delete",data:{templateId:t,filename:e}})}}}]);